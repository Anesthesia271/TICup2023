# TI Cup 2023 通信协议

串口通信统一使用57600波特率，8位数据位，**奇**校验，1位停止位

## 地图信息

上位机发送地图信息，以坐标+电压等级的形式发送，如 `58A 98a 43B 62b 63b\n` ，表示 $(5,8)$ 上有一个标识符为A的发电侧杆塔， $(9,8)$ 上有一个标识符为a的用电侧杆塔， $(4,3)$ 上有一个标识符为B的发电侧杆塔， $(6,2)$ 上有一个标识符为b的用电侧杆塔， $(6,3)$ 上有另一个标识符为b的用电侧杆塔。小车接受并处理完地图信息后，向上位机发送 `P\n` ，小车方可开始行动。若上位机在 $3000ms$ 后仍未收到小车回复，便会向小车重新发送地图信息，直到确认小车收到地图信息。

## 其他指令

| 发送方 |   字符   |  指令  | 解释                                                             |
|:---:|:------:|:----:|:---------------------------------------------------------------|
| 小车  | `C1\n` | 连接1  | 请求连接两个杆塔中的第一个                                                  |
| 小车  | `C2\n` | 连接2  | 请求连接两个杆塔中的第二个                                                  |
| 小车  | `CO\n` |  继续  | 小车消除请求合法时回复                                                    |
| 上位机 | `F\n`  |  无效  | 当小车消除请求不合法时回复（如：小车位于错误点位上）                                     |
| 上位机 | `S\n`  | 立即停止 | 收到指令时，小车应立即停止                                                  |
| 上位机 | `E\n`  | 比赛结束 | 收到指令表示小车可用步数已经用完，需要立刻停止行动                                      |
| 上位机 | `C\n`  | 死机检查 | 在小车运行过程中，上位机需要确定小车当前是否死机，<br>因此会不定时向小车发送该条指令，小车收到指令后正常<br>回复即可 |

对于以上指令，小车均需要在接收到后回复`R\n`，若上位机未收到小车回复，则会在 $100ms$ 延迟后向小车重新发送当前指令，若总计发送次数超过 `10` 次仍未收到小车回复，则立刻叫停比赛，向小车发送 `E\n` 结束本轮比赛。

## 位置请求

当小车不确定当前位置时，可以在开始行动后随时向上位机发送 `POS\n` ，上位机收到后，会以类似于 `45\n` 格式的回复，表示此时小车坐标为 $(4,5)$ 。注意！上位机会小车当前的浮点数坐标进行四舍五入后发送给小车，因此不能保证坐标完全正确。
